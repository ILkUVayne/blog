---
title: mysql索引
date: 2024-07-16 14:27:06
categories:
  - database
tags:
  - mysql
  - indexes
  - database
---

## 前言

索引用于快速查找具有特定列值的行。如果没有索引，MySQL 必须从第一行开始，然后读取整个表以查找相关行。表越大，成本就越高。如果表中有相关列的索引，MySQL 可以快速确定在数据文件中寻找的位置，而不必查看所有数据。这比按顺序读取每一行要快得多。

## 按数据结构分类

### B树索引

B树（B-trees）介绍可以参考：{% post_link algorithm/BTree实现原理 %}

页是InnoDB存储引擎磁盘管理的最小单位，默认16KB，一张表的索引并不能全部加载到内存中，每次读取一页，即一个索引节点，所以索引层数越低，IO次数越低，查询效率越高。

mysql使用的B+树是为了提升查询效率做的优化版本，非叶子节点只存储关键字。在节点的大小默认16KB的情况下，非叶子节点可以比B树存储更多的关键来降低树的高度，从而减少IO次数。

### 哈希索引

使用哈希表的方式索引数据，对于精确查找的效率会比较高。

### 空间索引

MySQL空间索引是一种基于空间数据类型的索引，它能够快速定位到数据集中的某个位置。空间索引适用于具有空间特征的数据，如地理位置、地址等。在MySQL中，空间索引可以提高查询效率，减少数据扫描的行数，从而提高查询速度。

空间索引使用R树（R-tree），R树是用来做空间数据存储的树状数据结构。

### 倒排索引（全文索引）

倒排索引（英语：Inverted index），也常被称为反向索引、置入档案或反向档案，是一种索引方法，被用来存储在全文搜索下某个单词在一个文档或者一组文档中的存储位置的映射。它是文档检索系统中最常用的数据结构。

## 按数据组织形式分类

### 聚簇索引

聚集索引是指数据库表行中数据的物理顺序与键值的逻辑（索引）顺序相同。 一个表只能有一个聚集索引，因为一个表的物理顺序只有一种情况，所以，对应的聚集索引只能有一个。一般表的主键会被建立为聚簇索引。

在InnoDB引擎下，聚簇索引的诞生过程如下：

1. 当你为一张表创建主键时，也就是定义 PRIMARY KEY 时，此时这张表的聚簇索引就是主键索引。通常情况下，我们应该为一张表设置一个主键，如果没有合适的列作为主键列，我们可以定义一个自动递增的唯一列为主键，并且在插入数据时是自动填充此列。
2. 如果一张表中没有设置主键，那么 InnoDB 会使用第一个唯一索引（unique），且此唯一索引设置了非空约束（not null），我们就使用它作为聚簇索引。
3. 如果一张表既没有主键索引，又没有符合条件的唯一索引，那么 InnoDB 会生成一个名为 GEN_CLUST_INDEX 的隐藏聚簇索引，这个隐藏的索引为 6 字节的长整数类型。

### 非聚簇索引

与聚簇索引不同，非聚集索引表行中数据的物理顺序与键值的逻辑（索引）顺序不相同，且叶子节点指向的数据中只存储了索引字段和主键ID，如果当前要查询的信息刚好是索引字段且不包含其他额外的字段信息，则表示索引覆盖，避免了回表操作（根据索引到的主键ID再次查询主键索引中所需要的数据），效率较高。反之，则需要回表二次查询。

## 按类型分类

### 主键索引

一张表只能有一个主键（唯一且非空），可以是单列也可以是多列组合，一般来说都是创建一个具有自动递增值的单独列作为主键。

### 唯一索引

字段在表中唯一（可为空），唯一索引可以是单列，也可以是多列。

### 普通索引

字段可重复的索引，可以是单列，也可以是多列。

### 多列索引

mysql可以在多个列上建立多列索引（复合索引），索引最多可包含 16 个列。

多列索引的查询需满足最左前缀原则，即查询的where条件必须包含复合索引最左边的第一个字段。例如：有复合索引(a,b,c)，则abc,ac,a均能使用索引（ac只使用了索引a）,而bc,c这种查询方式则不能使用索引。

## 总结

建立索引可以极大的提高查询的效率，但不必要的索引会浪费空间，并浪费 MySQL 确定使用哪些索引的时间。索引还会增加插入、更新和删除的成本，因为必须更新每个索引。必须找到适当的平衡，才能使用最佳索引集实现快速查询。

## ref

- [Mysql官方文档](https://dev.mysql.com/doc/refman/8.0/en/optimization-indexes.html)




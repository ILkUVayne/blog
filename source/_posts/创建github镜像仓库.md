---
title: 创建github镜像仓库
date: 2024-03-16 15:24:40
tags:
- image
- k8s
---

## 初衷

当需要拉取国外的一些镜像时，经常因为网络问题失败。但是通过换源的方式可能无法拉到最新的镜像，所以通过自己制作k8s镜像，通过阿里云镜像服务来代理的方式来拉取镜像。

## 创建github镜像仓库

### 1.创建仓库

需要创建一个github仓库，来存放你的镜像文件。例如我的仓库：https://github.com/ILkUVayne/registry

### 2.制作Dockerfile文件

假设需要拉取的国外镜像：

~~~bash
registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.4.0@sha256:44d1d0e9f19c63f58b380c5fddaca7cf22c7cee564adeff365225a5df5ef3334
~~~

创建对应的Dockerfile:

~~~bash
FROM registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.4.0@sha256:44d1d0e9f19c63f58b380c5fddaca7cf22c7cee564adeff365225a5df5ef3334
~~~

## 阿里云容器镜像服务

### 1.进入容器镜像服务，创建个人实例

进入容器镜像服务，创建个人实例
位置：**控制台->产品与服务->容器镜像服务**，进入容器镜像服务页面（没找到的话直接搜索**容器镜像服务**关键字）。
在实例列表中创建个人实例。

### 2.创建命令空间

进入个人实例后，选择 **仓库管理->命令空间**，创建命名空间。注意：个人版最多只能创建3个

### 3.创建镜像仓库

选择**仓库管理 -> 镜像仓库**，来创建镜像仓库，注意仓库类型要选择**公开**。

点击下一步后，选择Github代码源，然后选择上面创建的github镜像仓库，勾选**海外机器构建**，然后点击创建即可。注：如果阿里云没有绑定github帐户，这一步会先提示你先去绑定账号，绑定完成之后回来继续操作即可。

### 4.构建镜像

镜像仓库创建完后，直接点击进入该镜像仓库。然后选择**构建**。
此时，我们开始**添加规则**。选择分支和前面你创建的github仓库Dockerfile目录路径。
注意：Dockerfile目录，就是前面github里的镜像仓库文件夹的路径，镜像版本可以随意命令，一般建议跟你要拉取的镜像版本一致。

### 5.立即构建

构建规则添加完毕后，点击立即构建，那么就可以看到构建状态，状态为成功，那么该镜像版本就可以直接使用了。

## 使用镜像

在刚才镜像仓库的页面上，**基本信息**里就有操作指南，你可以直接按照指南来进行docker 拉取镜像的操作。

使用 **docker images** 命令查看镜像仓库和版本，替换对应yaml中的image即可